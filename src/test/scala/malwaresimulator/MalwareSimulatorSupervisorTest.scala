package malwaresimulator

import akka.actor.testkit.typed.scaladsl.ScalaTestWithActorTestKit
import org.scalatest.wordspec.AnyWordSpecLike

class MalwareSimulatorSupervisorTest extends ScalaTestWithActorTestKit with AnyWordSpecLike {
  "MalwareSimulatorSuperVisor actor" must {
    "reply WholeNetwork for ShowNet" in {
      val probe = createTestProbe[proto.WholeNetwork]()
      val mss = spawn(MalwareSimulatorSupervisor.apply)

      mss ! MalwareSimulatorSupervisor.ShowNet(probe.ref)

      probe.expectMessage(
        proto.WholeNetwork(
          Seq.empty
        )
      )

      mss ! MalwareSimulatorSupervisor.AddNetwork("network1", "10.0.0.0", 24)
      mss ! MalwareSimulatorSupervisor.AddNode("node1", "10.0.0.1")
      mss ! MalwareSimulatorSupervisor.AddNode("node2", "10.0.0.2")
      mss ! MalwareSimulatorSupervisor.MakeConnection(1, 0, "10.0.0.1", 24)
      mss ! MalwareSimulatorSupervisor.MakeConnection(2, 0, "10.0.0.2", 24)

      mss ! MalwareSimulatorSupervisor.ShowNet(probe.ref)

      probe.expectMessage(
        proto.WholeNetwork(
          Seq(
            proto.Network(
              0,
              "network1",
              "10.0.0.0",
              24,
              Seq(
                proto.Node(
                  1,
                  "node1",
                  "10.0.0.1",
                  Seq.empty
                ),
                proto.Node(
                  2,
                  "node2",
                  "10.0.0.2",
                  Seq.empty
                )
              )
            )
          )
        )
      )
    }

  }
}

